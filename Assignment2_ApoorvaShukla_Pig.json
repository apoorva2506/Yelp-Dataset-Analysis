{"paragraphs":[{"text":"%pig\r\n--LOAD jars\r\nREGISTER 'hdfs://dumbo/user/as11445/elephant-bird-hadoop-compat-4.15.jar'\r\nREGISTER 'hdfs://dumbo/user/as11445/elephant-bird-pig-4.15.jar'\r\nREGISTER 'hdfs://dumbo/user/as11445/json-simple-1.1.1.jar'\r\nREGISTER 'hdfs://dumbo/user/as11445/elephant-bird-core-4.15.jar'\r\nREGISTER 'hdfs://dumbo/user/as11445/piggybank-0.15.0.jar'\r\n","user":"anonymous","dateUpdated":"2018-03-24T21:51:30-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521426472619_-541273790","id":"20180318-222752_1343880116","dateCreated":"2018-03-18T22:27:52-0400","dateStarted":"2018-03-24T21:51:30-0400","dateFinished":"2018-03-24T21:51:30-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2350"},{"text":"%pig\n--LOAD the json files\ndata = LOAD 'hdfs://dumbo/user/as11445/business.json' USING com.twitter.elephantbird.pig.load.JsonLoader('-nestedLoad') as (json:map[]);\ndata1= LIMIT data 1;\n--dump data1;\nreview = LOAD 'hdfs://dumbo/user/as11445/review.json' USING com.twitter.elephantbird.pig.load.JsonLoader('-nestedLoad') as (rev:map[]);\nrev1= LIMIT review 1;\n--dump rev1;\nuserz= LOAD 'hdfs://dumbo/user/as11445/user.json' USING com.twitter.elephantbird.pig.load.JsonLoader('-nestedLoad') as (usr:map[]);\nusr1= LIMIT userz 1;\n--dump usr1;\nuscity= LOAD 'hdfs://dumbo/user/as11445/file.json' USING com.twitter.elephantbird.pig.load.JsonLoader('-nestedLoad') as (uscity:map[]);\nuscity1= LIMIT uscity 1;\n--dump uscity1;\n\n","user":"anonymous","dateUpdated":"2018-03-24T22:48:51-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521428829963_1528846026","id":"20180318-230709_1103824415","dateCreated":"2018-03-18T23:07:09-0400","dateStarted":"2018-03-24T21:51:28-0400","dateFinished":"2018-03-24T21:51:28-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2351"},{"text":"%pig\n-- Q1. Summarize the number of unique reviewers by US city, by business category.\nbusiness_data = FOREACH data GENERATE json#'city' as city, json#'categories' as categories, json#'business_id' as business_id;\nreview_data = FOREACH review GENERATE rev#'business_id' as business_id,rev#'user_id' as user_id;\njoined= JOIN business_data by business_id, review_data by business_id;\nflatten_business_data = FOREACH joined GENERATE user_id, city, FLATTEN(categories);\ngrouped_business_data = GROUP flatten_business_data BY (city,categories);\nfinal_df = FOREACH grouped_business_data GENERATE group.city as city , group.categories as category, COUNT(flatten_business_data.user_id);\ndump final_df;","user":"anonymous","dateUpdated":"2018-03-24T22:49:09-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521653540045_589531293","id":"20180321-133220_28869435","dateCreated":"2018-03-21T13:32:20-0400","dateStarted":"2018-03-24T22:23:15-0400","dateFinished":"2018-03-24T22:24:34-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2352"},{"text":"%pig\n--Q2. Rank all cities by # of stars descending, for each category\nbusiness_data = FOREACH data GENERATE json#'city' as city, json#'categories' as categories, json#'business_id' as business_id;\nreview_data = FOREACH review GENERATE  rev#'business_id' as business_id, (int)rev#'stars' as stars;\n\njoined= JOIN business_data by business_id, review_data by business_id;\nflatten_data = FOREACH joined GENERATE stars, city, FLATTEN(categories);\ngrouped= GROUP flatten_data by (categories, city);\nres= FOREACH grouped GENERATE FLATTEN(group) AS (categories, city), AVG(flatten_data.stars) AS rankings;\noutputer= ORDER res BY categories, rankings DESC;\ndump outputer;","user":"anonymous","dateUpdated":"2018-03-24T22:43:46-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig","editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521679393965_-1031936019","id":"20180321-204313_1721006297","dateCreated":"2018-03-21T20:43:13-0400","dateStarted":"2018-03-24T21:51:41-0400","dateFinished":"2018-03-24T21:53:52-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2353"},{"text":"%pig\n--Q3.  What is the average rank (# stars) for businesses within 15 km of Edinburgh Castle, Scotland, by type of business (category)? \n\ndist = FOREACH data GENERATE (double)json#'stars' as stars, json#'latitude' as latitude, json#'longitude' as longitude, (double)json#'review_count' as reviews, json#'categories' as categories:bag{a:tuple(b:chararray)} ;\ndist1 = FOREACH dist GENERATE stars,latitude,longitude,reviews, FLATTEN(categories) as categories;\ndist2 = FOREACH dist1 GENERATE *, (111.045* org.apache.pig.piggybank.evaluation.math.toDegrees(ACOS(COS(org.apache.pig.piggybank.evaluation.math.toRadians(55.9469753))* COS(org.apache.pig.piggybank.evaluation.math.toRadians(latitude))* COS(org.apache.pig.piggybank.evaluation.math.toRadians(-3.2096308) - org.apache.pig.piggybank.evaluation.math.toRadians(longitude))+ SIN(org.apache.pig.piggybank.evaluation.math.toRadians(55.9469753))* SIN(org.apache.pig.piggybank.evaluation.math.toRadians(latitude))))) as distance:double;\ndist3 = FILTER dist2 BY (distance<15);\ndist4 = GROUP dist3 BY categories;\ndist5 = FOREACH dist4 GENERATE group as category, AVG(dist3.stars);\ndist5_order= ORDER dist5 BY category;\ndump dist5_order;\n","user":"anonymous","dateUpdated":"2018-03-24T22:43:47-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521669028567_181857884","id":"20180321-175028_1222697270","dateCreated":"2018-03-21T17:50:28-0400","dateStarted":"2018-03-24T14:17:35-0400","dateFinished":"2018-03-24T14:19:01-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2354"},{"text":"%pig\n--Q5 For the top 10 and bottom 10 category Food businesses in Q3, (in terms of stars), summarize star rating for reviews in January through May only.\n\ndf_1 = FOREACH data GENERATE (double)json#'stars' as stars,json#'business_id' as id, json#'latitude' as latitude, json#'longitude' as longitude, json#'categories' as categories:bag{a:tuple(b:chararray)} ;\ndf_2 = FOREACH df_1 GENERATE stars,id,latitude,longitude, FLATTEN(categories) as categories;\ndf_3 = FOREACH df_2 GENERATE *, (111.045* org.apache.pig.piggybank.evaluation.math.toDegrees(ACOS(COS(org.apache.pig.piggybank.evaluation.math.toRadians(55.9469753))* COS(org.apache.pig.piggybank.evaluation.math.toRadians(latitude))* COS(org.apache.pig.piggybank.evaluation.math.toRadians( -3.2096308) - org.apache.pig.piggybank.evaluation.math.toRadians(longitude))+ SIN(org.apache.pig.piggybank.evaluation.math.toRadians(55.9469753))* SIN(org.apache.pig.piggybank.evaluation.math.toRadians(latitude))))) as distance:double;\ndf_4 = FILTER df_3 BY (distance<15) AND (categories=='Food');\ndf_5 = GROUP df_4 BY id;\ndf_6 = FOREACH df_5 GENERATE group as id, AVG(df_4.stars) as stars;\ndump df_6;\n\ndf_top = ORDER df_6 BY stars DESC;\ntop10 = limit df_top 10;\n--dump top10;\n\ndf_bottom= ORDER df_6 BY stars ASC;\nbottom10 = limit df_bottom 10;\n--dump bottom10;\n\nreview1= FOREACH review GENERATE rev#'stars' as stars, rev#'business_id' as id, rev#'date' as date;\ntotal_df = UNION top10, bottom10;\ndump total_df;\njoined_review = JOIN review1 by id, total_df by id;\nfinal_required_data = FOREACH joined_review GENERATE total_df::id as bid, (double)review1::stars as star,SUBSTRING(review1::date,5,7) as month;\nfinal_data_by_month = FILTER final_required_data BY (month matches '01|02|03|04|05');\n--dump final_data_by_month;\n\ngrouped_data_by_business = GROUP final_data_by_month by bid;\navg_rating = FOREACH grouped_data_by_business GENERATE group, AVG(final_data_by_month.star) as avg_stars;\ndump avg_rating;\n\n","user":"anonymous","dateUpdated":"2018-03-24T22:43:47-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521667351909_1213775813","id":"20180321-172231_316741872","dateCreated":"2018-03-21T17:22:31-0400","dateStarted":"2018-03-24T22:29:39-0400","dateFinished":"2018-03-24T22:36:01-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2355"},{"text":"%pig\n--Q4 Rank reviewers in Q3 by their number of reviews. For the top 10 reviewers, show their average number of stars, by category.\n\nusers= FOREACH userz GENERATE usr#'user_id' as user_id, usr#'name' as name, (int)usr#'review_count' as review_count;\ndist = FOREACH data GENERATE (double)json#'stars' as stars, json#'business_id' as business_id, json#'latitude' as latitude, json#'longitude' as longitude, (double)json#'review_count' as reviews, json#'categories' as categories:bag{a:tuple(b:chararray)} ;\nrevs= FOREACH review GENERATE rev#'business_id' as business_id, (int)rev#'stars' as stars, rev#'business_id' as business_id, rev#'user_id' as user_id;\n\ndist1 = FOREACH dist GENERATE business_id,stars,latitude,longitude,reviews, FLATTEN(categories) as categories;\ndist2 = FOREACH dist1 GENERATE *, (111.045* org.apache.pig.piggybank.evaluation.math.toDegrees(ACOS(COS(org.apache.pig.piggybank.evaluation.math.toRadians(55.9469753))* COS(org.apache.pig.piggybank.evaluation.math.toRadians(latitude))* COS(org.apache.pig.piggybank.evaluation.math.toRadians(-3.2096308) - org.apache.pig.piggybank.evaluation.math.toRadians(longitude))+ SIN(org.apache.pig.piggybank.evaluation.math.toRadians(55.9469753))* SIN(org.apache.pig.piggybank.evaluation.math.toRadians(latitude))))) as distance:double;\ndist3 = FILTER dist2 BY (distance<15);\n\njoin_3rev= JOIN dist3 by business_id, revs by business_id;\n\n\ndist4 = GROUP dist3 BY categories;\ndist5 = FOREACH dist4 GENERATE group as category, AVG(dist3.stars);\ndump dist5;\n\n\n","user":"anonymous","dateUpdated":"2018-03-24T22:43:47-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521759932073_97840902","id":"20180322-190532_330884655","dateCreated":"2018-03-22T19:05:32-0400","dateStarted":"2018-03-24T21:57:50-0400","dateFinished":"2018-03-24T21:58:26-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2356"},{"text":"%pig\n","user":"anonymous","dateUpdated":"2018-03-22T23:40:37-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"pig","editOnDblClick":false},"editorMode":"ace/mode/pig"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521776437975_-1913398048","id":"20180322-234037_602351444","dateCreated":"2018-03-22T23:40:37-0400","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2357"}],"name":"Assignment2_ApoorvaShukla_Pig","id":"2D8YVV4X5","angularObjects":{"2CFXK5J4Y:shared_process":[],"2CF295UYG:shared_process":[],"2CD6ZRPDJ:shared_process":[],"2CFG6Y8G3:shared_process":[],"2CFJKQVBN:shared_process":[],"2CGYXR37V:shared_process":[],"2CDY97F39:shared_process":[],"2CEC5KMFB:shared_process":[],"2CFFWS5P3:shared_process":[],"2CDM4T1EH:shared_process":[],"2CG949ZHZ:shared_process":[],"2CEJ86HV3:shared_process":[],"2CFGNABPQ:shared_process":[],"2CEZV3CHG:shared_process":[],"2CDUTWP3P:shared_process":[],"2CFXDXWCE:shared_process":[],"2CEZMWG72:shared_process":[],"2CFWFHNZR:shared_process":[],"2CG23YGEZ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}