{"paragraphs":[{"text":"//Load\r\nimport org.apache.spark.sql.functions._ \r\nval sqlContext = new org.apache.spark.sql.SQLContext(sc)\r\nimport sqlContext.implicits._\r\n\r\nval uscity = sqlContext.read.json(\"file.json\")\r\n//uscity.show()\r\nval uscity1 = uscity.withColumnRenamed(\"city\", \"city1\")\r\nuscity1.registerTempTable(\"uscity1\")\r\n\r\n","user":"anonymous","dateUpdated":"2018-03-24T21:32:29-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport org.apache.spark.sql.functions._\n\nsqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@643c267d\n\nimport sqlContext.implicits._\n\nuscity: org.apache.spark.sql.DataFrame = [_corrupt_record: string, city: string, city_ascii: string, county_fips: string, county_name: string, id: string, lat: string, lng: string, population: string, source: string, state_id: string, state_name: string, zip: string]\n\nuscity1: org.apache.spark.sql.DataFrame = [_corrupt_record: string, city1: string, city_ascii: string, county_fips: string, county_name: string, id: string, lat: string, lng: string, population: string, source: string, state_id: string, state_name: string, zip: string]\n"}]},"apps":[],"jobName":"paragraph_1521656852006_1325073190","id":"20180321-142732_695080248","dateCreated":"2018-03-21T14:27:32-0400","dateStarted":"2018-03-24T21:32:29-0400","dateFinished":"2018-03-24T21:33:03-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1361"},{"text":"//load json\nval data = sqlContext.read.json(\"business.json\")\nval data1 = data.withColumn(\"categories1\", explode($\"categories\"))\ndata1.registerTempTable(\"data1\")\n\nval rev= sqlContext.read.json(\"review.json\")\nrev.registerTempTable(\"rev\")\nval rev1 = rev.withColumnRenamed(\"stars\", \"stars1\")\nrev1.registerTempTable(\"rev1\")\nrev1.show()\n\n","user":"anonymous","dateUpdated":"2018-03-24T21:34:10-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndata: org.apache.spark.sql.DataFrame = [address: string, attributes: array<string>, business_id: string, categories: array<string>, city: string, hours: array<string>, is_open: bigint, latitude: double, longitude: double, name: string, neighborhood: string, postal_code: string, review_count: bigint, stars: double, state: string, type: string]\n\ndata1: org.apache.spark.sql.DataFrame = [address: string, attributes: array<string>, business_id: string, categories: array<string>, city: string, hours: array<string>, is_open: bigint, latitude: double, longitude: double, name: string, neighborhood: string, postal_code: string, review_count: bigint, stars: double, state: string, type: string, categories1: string]\n\nrev: org.apache.spark.sql.DataFrame = [business_id: string, cool: bigint, date: string, funny: bigint, review_id: string, stars: bigint, text: string, useful: bigint, user_id: string]\n\nrev1: org.apache.spark.sql.DataFrame = [business_id: string, cool: bigint, date: string, funny: bigint, review_id: string, stars1: bigint, text: string, useful: bigint, user_id: string]\n+--------------------+----+----------+-----+--------------------+------+--------------------+------+--------------------+\n|         business_id|cool|      date|funny|           review_id|stars1|                text|useful|             user_id|\n+--------------------+----+----------+-----+--------------------+------+--------------------+------+--------------------+\n|uYHaNptLzDLoV_JZ_...|   0|2016-07-12|    0|VfBHSwC5Vz_pbFluy...|     5|My girlfriend and...|     0|cjpdDjZyprfyDG3Rl...|\n|uYHaNptLzDLoV_JZ_...|   0|2016-10-02|    0|3zRpneRKDsOPq92tq...|     3|If you need an in...|     0|bjTcT8Ty4cJZhEOEo...|\n|uYHaNptLzDLoV_JZ_...|   0|2015-09-17|    0|ne5WhI1jUFOcRn-b-...|     3|Mittlerweile gibt...|     0|AXgRULmWcME7J6Ix3...|\n|uYHaNptLzDLoV_JZ_...|   0|2016-08-21|    0|llmdwOgDReucVoWEr...|     4|Location is every...|     0|oU2SSOmsp_A8JYI7Z...|\n|uYHaNptLzDLoV_JZ_...|   0|2013-11-20|    0|DuffS87NaSMDmIflu...|     5|gute lage im stad...|     0|0xtbPEna2Kei11vsU...|\n|uYHaNptLzDLoV_JZ_...|   0|2016-06-05|    0|GvLmUkjUrOyFH8KFn...|     5|Erstklassige Lage...|     0|rW8q706dz5-NnXDzM...|\n|uYHaNptLzDLoV_JZ_...|   0|2015-02-21|    0|lGEl24NGj2HVBJrod...|     4|Beautiful space, ...|     0|yx8vNXUL0D0HS8rUI...|\n|uYHaNptLzDLoV_JZ_...|   0|2013-07-07|    0|cUgvEy5wj7zYE68v1...|     4|This is a fairly ...|     0|zXnH6W74FAJQ7q7b-...|\n|uYHaNptLzDLoV_JZ_...|   2|2013-04-27|    0|FSB_BnvysBgH3JYrb...|     4|First time at thi...|     2|c5yp5hxwC1N98MjbV...|\n|uYHaNptLzDLoV_JZ_...|   0|2015-04-13|    0|dhl3ZW9aAEX_T7_um...|     4|Location location...|     2|xJisL5w4wOgiYLokG...|\n|uYHaNptLzDLoV_JZ_...|   1|2016-11-08|    1|JQJvnM3p-3eML05eK...|     4|A hotel that has ...|     1|tgV6tsYQ66DZ3LQKv...|\n|uYHaNptLzDLoV_JZ_...|   0|2015-07-27|    0|6JF4WfHgwYrrdZ2Ve...|     3|Stayed here for t...|     1|Q-3YCVywc03w56wYt...|\n|uYHaNptLzDLoV_JZ_...|   0|2014-05-07|    0|fbVYETRuWDw8Qnpim...|     4|Well, i like the ...|     1|Cx4UCow0zQgFQOp47...|\n|uYHaNptLzDLoV_JZ_...|   0|2015-02-26|    0|lobj38NgaokqVseN8...|     4|I really do love ...|     1|eqWEgMH-DCP74i82B...|\n|uYHaNptLzDLoV_JZ_...|   1|2015-08-21|    0|ysfjtAWreLoy7um8W...|     5|Motel One sets th...|     1|d0DGZRp6lHXGECJSc...|\n|uYHaNptLzDLoV_JZ_...|   0|2013-12-07|    0|OF1ToqGAubsWGri5i...|     3|Had Continental s...|     1|IpLZ7RevQrFPJWYc9...|\n|jQsNFOzDpxPmOurSW...|   0|2017-06-03|    0|ByRzJ8rF2KJWLr-cU...|     1|This place is hor...|     0|kzyLOqiJvyw_FWFTw...|\n|jQsNFOzDpxPmOurSW...|   0|2015-03-26|    0|i5UwUPlQFPLcE8p2g...|     4|For being fairly ...|     1|WZXp9-V2dqRRJqhGg...|\n|jQsNFOzDpxPmOurSW...|   1|2012-12-30|    1|EyQyvTTg2jX4or9bB...|     5|I decided to try ...|     2|XylT12exfdLiI_3uD...|\n|jQsNFOzDpxPmOurSW...|   1|2009-01-12|    1|G-EFA005besj5uHsH...|     3|I'm not saying Pe...|     1|Ji9PeffxjwqPLO7pE...|\n+--------------------+----+----------+-----+--------------------+------+--------------------+------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1521932411415_-619283177","id":"20180324-190011_1647051701","dateCreated":"2018-03-24T19:00:11-0400","dateStarted":"2018-03-24T21:33:20-0400","dateFinished":"2018-03-24T21:33:45-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1362"},{"text":"//1. Summarize the number of unique reviewers by US city, by business category. That is, count the unique reviewers by city, by business.\nval joined_citybus=uscity1.join(data1, uscity1(\"city1\") === data1(\"city\"), \"inner\")\njoined_citybus.registerTempTable(\"joined_citybus\")\n\nval joined_df = joined_citybus.join(rev, joined_citybus(\"business_id\") === rev(\"business_id\"), \"inner\")\njoined_df.registerTempTable(\"joined_df\")\n\nval count_reviewers = sqlContext.sql(\"SELECT count(user_id) as no_of_reviwers, city1, categories1 FROM joined_df GROUP BY city1, categories1\")\ncount_reviewers.registerTempTable(\"count_reviewers\")\ncount_reviewers.show()","user":"anonymous","dateUpdated":"2018-03-24T21:33:55-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\njoined_citybus: org.apache.spark.sql.DataFrame = [_corrupt_record: string, city1: string, city_ascii: string, county_fips: string, county_name: string, id: string, lat: string, lng: string, population: string, source: string, state_id: string, state_name: string, zip: string, address: string, attributes: array<string>, business_id: string, categories: array<string>, city: string, hours: array<string>, is_open: bigint, latitude: double, longitude: double, name: string, neighborhood: string, postal_code: string, review_count: bigint, stars: double, state: string, type: string, categories1: string]\n\njoined_df: org.apache.spark.sql.DataFrame = [_corrupt_record: string, city1: string, city_ascii: string, county_fips: string, county_name: string, id: string, lat: string, lng: string, population: string, source: string, state_id: string, state_name: string, zip: string, address: string, attributes: array<string>, business_id: string, categories: array<string>, city: string, hours: array<string>, is_open: bigint, latitude: double, longitude: double, name: string, neighborhood: string, postal_code: string, review_count: bigint, stars: double, state: string, type: string, categories1: string, business_id: string, cool: bigint, date: string, funny: bigint, review_id: string, stars: bigint, text: string, useful: bigint, user_id: string]\n\ncount_reviewers: org.apache.spark.sql.DataFrame = [no_of_reviwers: bigint, city1: string, categories1: string]\n+--------------+----------------+--------------------+\n|no_of_reviwers|           city1|         categories1|\n+--------------+----------------+--------------------+\n|           381|       Stuttgart|             Museums|\n|        244088|         Toronto|           Nightlife|\n|         43836|       Las Vegas|        Music Venues|\n|         78771|       Charlotte|       Beauty & Spas|\n|          4358|       Las Vegas|              Fondue|\n|          4151|       Charlotte|   Specialty Schools|\n|           697|       Edinburgh|             Grocery|\n|            37|      Scottsdale| Personal Assistants|\n|         13020|         Phoenix|     Carpet Cleaning|\n|            31|   Richmond Hill|Auto Parts & Supp...|\n|           532|         Toronto|Amateur Sports Teams|\n|          1026|       Las Vegas|           Libraries|\n|         45444|         Phoenix|                Pets|\n|           968|       Las Vegas|Home & Rental Ins...|\n|          4940| North Las Vegas|                Food|\n|           104|     Streetsboro|          Automotive|\n|             5|North Ridgeville|      Local Services|\n|            49|       Inverness|           Computers|\n|           744|  Cuyahoga Falls|                Food|\n|           277|    Strongsville|               Salad|\n+--------------+----------------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1521933417409_1273877861","id":"20180324-191657_359975696","dateCreated":"2018-03-24T19:16:57-0400","dateStarted":"2018-03-24T21:33:55-0400","dateFinished":"2018-03-24T21:35:15-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1363"},{"text":"// 3.  What is the average rank (# stars) for businesses within 15 km of Edinburgh Castle, Scotland, by type of business (category)?\nval dist_df1 = data1.select(\"business_id\",\"latitude\",\"longitude\",\"name\",\"stars\",\"review_count\",\"categories1\",\"city\")\ndist_df1.registerTempTable(\"dist_df1\")\nval dist_table= sqlContext.sql(\"SELECT business_id,name,stars,categories1, review_count,city, latitude, longitude, (111.045* DEGREES(ACOS(COS(RADIANS(latpoint))* COS(RADIANS(latitude))* COS(RADIANS(longpoint) - RADIANS(longitude))+ SIN(RADIANS(latpoint))* SIN(RADIANS(latitude))))) AS distance_in_km FROM dist_df1 JOIN (SELECT  55.9469753 AS latpoint, -3.2096308 AS longpoint) AS p ON 1=1 ORDER BY city\")\ndist_table.registerTempTable(\"dist_table\")\n//dist_table.show()\nsqlContext.sql(\"SELECT avg(stars) AS AVERAGE_STARS, categories1 FROM dist_table WHERE distance_in_km<15 group by categories1 order by categories1\").show()\n\n","user":"anonymous","dateUpdated":"2018-03-24T21:35:52-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndist_df1: org.apache.spark.sql.DataFrame = [business_id: string, latitude: double, longitude: double, name: string, stars: double, review_count: bigint, categories1: string, city: string]\n\ndist_table: org.apache.spark.sql.DataFrame = [business_id: string, name: string, stars: double, categories1: string, review_count: bigint, city: string, latitude: double, longitude: double, distance_in_km: double]\n+------------------+--------------------+\n|     AVERAGE_STARS|         categories1|\n+------------------+--------------------+\n| 3.642857142857143|         Accessories|\n| 4.004545454545455|         Active Life|\n|               4.5|         Acupuncture|\n|               4.5|  Addiction Medicine|\n|3.5555555555555554|               Adult|\n|3.6666666666666665|     Adult Education|\n|               3.0| Adult Entertainment|\n|               4.0|              Afghan|\n|4.2272727272727275|             African|\n|               4.0|     Airport Lounges|\n|               4.1|    Airport Shuttles|\n|               3.0|            Airports|\n|3.5294117647058822|      American (New)|\n| 3.426829268292683|American (Traditi...|\n|               4.0|     Amusement Parks|\n|             3.875|     Animal Shelters|\n| 4.173913043478261|            Antiques|\n|               4.2|          Apartments|\n|               3.5|          Appliances|\n|               3.5| Appliances & Repair|\n+------------------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1521656865324_2103651722","id":"20180321-142745_54923333","dateCreated":"2018-03-21T14:27:45-0400","dateStarted":"2018-03-24T14:33:23-0400","dateFinished":"2018-03-24T14:33:32-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1364"},{"text":"// q2.  Rank all cities by # of stars descending, for each category\n\nsqlContext.sql(\"SELECT categories1,city,avg(stars) as avg_stars from data1 group by categories1,city order by categories1 asc, avg_stars desc\").show()","user":"anonymous","dateUpdated":"2018-03-24T21:55:22-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+------------+-----------------+\n|      categories1|        city|        avg_stars|\n+-----------------+------------+-----------------+\n|       & Probates|    Glendale|              5.0|\n|       & Probates|  Pittsburgh|              5.0|\n|       & Probates|   Champaign|              5.0|\n|       & Probates|     Gilbert|4.666666666666667|\n|       & Probates|  Scottsdale|              4.5|\n|       & Probates|       Tempe|              4.5|\n|       & Probates|     Phoenix|              4.5|\n|       & Probates|        Mesa|              4.0|\n|       & Probates|   Henderson|            3.875|\n|       & Probates|   Las Vegas|             3.75|\n|      3D Printing|   Henderson|              5.0|\n|      3D Printing|     Toronto|            3.375|\n|ATV Rentals/Tours|  Pittsburgh|              5.0|\n|ATV Rentals/Tours|  Scottsdale|              5.0|\n|ATV Rentals/Tours|    Carnegie|              5.0|\n|ATV Rentals/Tours|      Peoria|              5.0|\n|ATV Rentals/Tours|    Sun City|              5.0|\n|ATV Rentals/Tours|        Mesa|              5.0|\n|ATV Rentals/Tours|     Phoenix|             4.75|\n|ATV Rentals/Tours|Boulder City|             4.75|\n+-----------------+------------+-----------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1521931172573_-720645637","id":"20180324-183932_1426301315","dateCreated":"2018-03-24T18:39:32-0400","dateStarted":"2018-03-24T21:35:56-0400","dateFinished":"2018-03-24T21:35:58-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1365"},{"text":"val usr= sqlContext.read.json(\"user.json\")\nusr.registerTempTable(\"usr\")\n//usr.show()\nval usr1 = usr.withColumnRenamed(\"review_count\", \"rev_cnt\")\nusr1.registerTempTable(\"usr1\")\nusr1.show()","user":"anonymous","dateUpdated":"2018-03-24T21:36:04-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nusr: org.apache.spark.sql.DataFrame = [average_stars: double, compliment_cool: bigint, compliment_cute: bigint, compliment_funny: bigint, compliment_hot: bigint, compliment_list: bigint, compliment_more: bigint, compliment_note: bigint, compliment_photos: bigint, compliment_plain: bigint, compliment_profile: bigint, compliment_writer: bigint, cool: bigint, elite: array<bigint>, fans: bigint, friends: array<string>, funny: bigint, name: string, review_count: bigint, useful: bigint, user_id: string, yelping_since: string]\n\nusr1: org.apache.spark.sql.DataFrame = [average_stars: double, compliment_cool: bigint, compliment_cute: bigint, compliment_funny: bigint, compliment_hot: bigint, compliment_list: bigint, compliment_more: bigint, compliment_note: bigint, compliment_photos: bigint, compliment_plain: bigint, compliment_profile: bigint, compliment_writer: bigint, cool: bigint, elite: array<bigint>, fans: bigint, friends: array<string>, funny: bigint, name: string, rev_cnt: bigint, useful: bigint, user_id: string, yelping_since: string]\n+-------------+---------------+---------------+----------------+--------------+---------------+---------------+---------------+-----------------+----------------+------------------+-----------------+-----+--------------------+----+--------------------+-----+---------+-------+------+--------------------+-------------+\n|average_stars|compliment_cool|compliment_cute|compliment_funny|compliment_hot|compliment_list|compliment_more|compliment_note|compliment_photos|compliment_plain|compliment_profile|compliment_writer| cool|               elite|fans|             friends|funny|     name|rev_cnt|useful|             user_id|yelping_since|\n+-------------+---------------+---------------+----------------+--------------+---------------+---------------+---------------+-----------------+----------------+------------------+-----------------+-----+--------------------+----+--------------------+-----+---------+-------+------+--------------------+-------------+\n|          3.8|           5174|            284|            5174|          5175|             78|            299|           1435|             7829|            7397|               569|             1834|16856|[2014, 2016, 2013...| 209|[M19NwFwAXKRZzt8k...|16605|      Cin|    272| 17019|lsSiIjAKVl-QRxKjR...|   2010-07-13|\n|         3.94|           1556|            211|            1556|          1285|            101|            134|           1295|              162|            2134|                74|              402|40110|[2014, 2017, 2011...| 835|[eoSSJzdprj3jxXyi...|10882|   Andrea|   2559| 83681|om5ZiponkpRqUNa3p...|   2006-01-18|\n|         4.72|             15|              1|              15|             5|              0|              1|             11|                8|              20|                 0|                1|   55|                  []|  17|[Oa84FFGBw1axX8O6...|    4|     Gabe|    277|    45|-lGwMGHMC_XihFJNK...|   2014-10-31|\n|         3.76|              9|              0|               9|             1|              0|              1|              4|                1|              11|                 0|                3|    4|        [2016, 2017]|  11|[96DJovjKAtExnyBZ...|    4|     Leah|    436|    15|D-ydMTPGWXTVm4_jj...|   2013-04-01|\n|         4.23|            276|              0|             276|            59|              0|              8|             51|              169|             386|                 3|               29| 6006|        [2017, 2016]|  49|[iN0A6QIrEFYoSGHF...|  360|     Juan|    921|  9152|PcvbBOCOcs6_suRDH...|   2012-08-16|\n|          5.0|              0|              0|               0|             0|              0|              0|              0|                0|               0|                 0|                1|    1|                  []|   1|[HanGVaZP_0IwhQdc...|    2|Charmaine|     22|     1|uXjR2GhCAYhqxVr21...|   2011-10-14|\n|          4.4|              9|              0|               9|             8|              0|              2|              1|                1|               4|                 0|                1|    0|        [2017, 2016]|  17|[ZWD8UH1T7QXQr0Eq...|    0| Victoria|     91|     0|N2arP_u4sMGLgOZhA...|   2013-12-20|\n|         4.06|              4|              0|               4|             5|              0|              5|              4|                5|               5|                 1|               22|    1|        [2016, 2015]|   5|[Puvuej6lzJ1JOEmt...|    3|    Erica|     68|     5|YHJIMK_zVH_VY6HCY...|   2012-06-08|\n|         3.63|              4|              0|               4|             1|              0|              3|              1|                0|               2|                 0|                0|    2|                  []|   3|[b8NTnxrhHCs6IPAK...|   11|  Whitney|    184|   141|g3V76Ja0XgWS1rqx0...|   2007-09-11|\n|         4.19|              1|              0|               1|             0|              0|              0|              2|                0|               1|                 0|                3|    2|                  []|   5|[lM_HnyWHrpBsrgts...|    6|     Paul|     48|     0|VTL4Dep5p7XrrOtgn...|   2010-04-25|\n|          4.1|           1302|             41|            1302|           806|             20|             46|            725|              106|            3159|                35|              220|19108|[2016, 2014, 2015...| 435|[xRYvFaMGWsvKcLCF...| 4880|     Risa|   1122| 26395|Wc5L6iuvSNF5WGBlq...|   2011-07-30|\n|         3.91|              7|              0|               7|             1|              0|              1|              8|                2|              17|                 0|                5|   45|  [2016, 2017, 2015]|   6|[ZRHPR_mj9A1p6guJ...|   21|  Andreas|    375|    41|gGdg9LOh61iUX1ui6...|   2013-11-25|\n|         3.87|             34|              2|              34|             9|              0|              3|             12|                2|              21|                 2|               10|  150|                  []|  33|[ACwN_B8nl4yJ4Flq...|   93|    Nikki|    100|   254|UUVbV8XmTzNksBOPa...|   2012-02-22|\n|         3.79|           1139|             87|            1139|           782|             54|            103|            391|              113|            1455|                31|              286|45234|[2012, 2008, 2009...| 198|[KOwp5RDbm7cDyrdX...|10715|    Holly|    698| 24047|Dd-TkEszFMkSF-vRi...|   2006-07-03|\n|         3.54|             17|              0|              17|            10|              0|              3|             12|                4|              12|                 0|               12|    2|  [2013, 2014, 2016]|   8|[ZWD8UH1T7QXQr0Eq...|    5|   Vivian|     73|    34|uxKSnOVAoEj4I6X9Y...|   2013-03-02|\n|         3.97|            210|             38|             210|           201|              5|             14|             53|               24|             128|                19|              126|   37|[2017, 2010, 2014...| 253|[BMemw48ent0pHRLi...|   32| Veronica|   1409|    69|ibvH1Y7Rh_tstiWgH...|   2007-05-01|\n|         4.07|              4|              0|               4|             3|              0|              1|              1|                0|               1|                 0|                1|   14|                  []|   4|[ZAkeWdyAQy37YYb5...|    3|    Ember|     24|    41|NUEQYD6T-ixWejImJ...|   2013-01-20|\n|         4.14|              5|              0|               5|             2|              0|              0|              7|                0|               7|                 0|                1|  204|[2015, 2016, 2017...|  13|[PoSe-DGfpk6Tu_WZ...|  199|     Jeff|    134|   258|tjufYqU4PWkP2j6vA...|   2011-04-03|\n|         4.33|              3|              0|               3|             4|              0|              0|              3|                0|               4|                 0|                0|   18|                  []|   2|[zlIqCecpj5s3EVUN...|   14|   SUMMER|     22|    29|kyhxBq6x_Pl1GEgq0...|   2011-04-29|\n|          3.5|              0|              0|               0|             0|              0|              0|              0|                0|               0|                 0|                0|    0|                  []|   0|[AxCC5tIDB9emRGGA...|    0| Danielle|      8|     0|RBqsD06DqXJnfYxhf...|   2015-09-12|\n+-------------+---------------+---------------+----------------+--------------+---------------+---------------+---------------+-----------------+----------------+------------------+-----------------+-----+--------------------+----+--------------------+-----+---------+-------+------+--------------------+-------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1521916469228_-552964718","id":"20180324-143429_8243478","dateCreated":"2018-03-24T14:34:29-0400","dateStarted":"2018-03-24T21:36:04-0400","dateFinished":"2018-03-24T21:36:22-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1366"},{"text":"// 4. Rank reviewers in Q3 by their number of reviews. For the top 10 reviewers, show their average number of stars, by category.\n\nval dist_df1 = data1.select(\"business_id\",\"latitude\",\"longitude\",\"name\",\"stars\",\"review_count\",\"categories1\",\"city\")\ndist_df1.registerTempTable(\"dist_df1\")\nval dist_table= sqlContext.sql(\"SELECT business_id,name,stars,categories1, review_count,city, latitude, longitude, (111.045* DEGREES(ACOS(COS(RADIANS(latpoint))* COS(RADIANS(latitude))* COS(RADIANS(longpoint) - RADIANS(longitude))+ SIN(RADIANS(latpoint))* SIN(RADIANS(latitude))))) AS distance_in_km FROM dist_df1 JOIN (SELECT  55.9469753 AS latpoint, -3.2096308 AS longpoint) AS p ON 1=1 ORDER BY city\")\ndist_table.registerTempTable(\"dist_table\")\n//dist_table.show()\nval business_filtered= sqlContext.sql(\"SELECT * FROM dist_table WHERE distance_in_km<15\")\n//business_filtered.show()\n\nval joined_busrev = business_filtered.join(rev1, business_filtered(\"business_id\") === rev1(\"business_id\"), \"inner\")\njoined_busrev.registerTempTable(\"joined_busrev\")\n\nval joined_revusrs = joined_busrev.join(usr1, joined_busrev(\"user_id\") === usr1(\"user_id\"), \"inner\")\njoined_revusrs.registerTempTable(\"joined_revusrs\")\n\n\nval ord_users= joined_revusrs.orderBy(desc(\"rev_cnt\")).limit(10);\nord_users.registerTempTable(\"ord_users\")\nord_users.show()\n\nval avg_stars = sqlContext.sql(\"SELECT avg(stars1), categories1 FROM ord_users GROUP BY categories1\")\navg_stars.registerTempTable(\"avg_stars\")\navg_stars.show()","user":"anonymous","dateUpdated":"2018-03-24T21:39:51-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndist_df1: org.apache.spark.sql.DataFrame = [business_id: string, latitude: double, longitude: double, name: string, stars: double, review_count: bigint, categories1: string, city: string]\n\ndist_table: org.apache.spark.sql.DataFrame = [business_id: string, name: string, stars: double, categories1: string, review_count: bigint, city: string, latitude: double, longitude: double, distance_in_km: double]\n\nbusiness_filtered: org.apache.spark.sql.DataFrame = [business_id: string, name: string, stars: double, categories1: string, review_count: bigint, city: string, latitude: double, longitude: double, distance_in_km: double]\n\njoined_busrev: org.apache.spark.sql.DataFrame = [business_id: string, name: string, stars: double, categories1: string, review_count: bigint, city: string, latitude: double, longitude: double, distance_in_km: double, business_id: string, cool: bigint, date: string, funny: bigint, review_id: string, stars1: bigint, text: string, useful: bigint, user_id: string]\njoined_revusrs: org.apache.spark.sql.DataFrame = [business_id: string, name: string, stars: double, categories1: string, review_count: bigint, city: string, latitude: double, longitude: double, distance_in_km: double, business_id: string, cool: bigint, date: string, funny: bigint, review_id: string, stars1: bigint, text: string, useful: bigint, user_id: string, average_stars: double, compliment_cool: bigint, compliment_cute: bigint, compliment_funny: bigint, compliment_hot: bigint, compliment_list: bigint, compliment_more: bigint, compliment_note: bigint, compliment_photos: bigint, compliment_plain: bigint, compliment_profile: bigint, compliment_writer: bigint, cool: bigint, elite: array<bigint>, fans: bigint, friends: array<string>, funny: bigint, name: string, rev_cnt: bigint, useful:...ord_users: org.apache.spark.sql.DataFrame = [business_id: string, name: string, stars: double, categories1: string, review_count: bigint, city: string, latitude: double, longitude: double, distance_in_km: double, business_id: string, cool: bigint, date: string, funny: bigint, review_id: string, stars1: bigint, text: string, useful: bigint, user_id: string, average_stars: double, compliment_cool: bigint, compliment_cute: bigint, compliment_funny: bigint, compliment_hot: bigint, compliment_list: bigint, compliment_more: bigint, compliment_note: bigint, compliment_photos: bigint, compliment_plain: bigint, compliment_profile: bigint, compliment_writer: bigint, cool: bigint, elite: array<bigint>, fans: bigint, friends: array<string>, funny: bigint, name: string, rev_cnt: bigint, useful: bigi...+--------------------+--------------------+-----+--------------------+------------+---------+----------+----------+------------------+--------------------+----+----------+-----+--------------------+------+--------------------+------+--------------------+-------------+---------------+---------------+----------------+--------------+---------------+---------------+---------------+-----------------+----------------+------------------+-----------------+-----+--------------------+----+--------------------+-----+-----+-------+------+--------------------+-------------+\n|         business_id|                name|stars|         categories1|review_count|     city|  latitude| longitude|    distance_in_km|         business_id|cool|      date|funny|           review_id|stars1|                text|useful|             user_id|average_stars|compliment_cool|compliment_cute|compliment_funny|compliment_hot|compliment_list|compliment_more|compliment_note|compliment_photos|compliment_plain|compliment_profile|compliment_writer| cool|               elite|fans|             friends|funny| name|rev_cnt|useful|             user_id|yelping_since|\n+--------------------+--------------------+-----+--------------------+------------+---------+----------+----------+------------------+--------------------+----+----------+-----+--------------------+------+--------------------+------+--------------------+-------------+---------------+---------------+----------------+--------------+---------------+---------------+---------------+-----------------+----------------+------------------+-----------------+-----+--------------------+----+--------------------+-----+-----+-------+------+--------------------+-------------+\n|uAinKQxXlMz1DvnZa...|    Nairn's Oatcakes|  4.0|            Bakeries|           3|Edinburgh|55.9323726| -3.151056|3.9875117205937607|uAinKQxXlMz1DvnZa...|   1|2013-11-01|    2|yto19VIHuo_c8qHib...|     4|Im waiting for Na...|     1|P5bUL3Engv-2z6kKo...|         3.79|           1129|             47|            1129|           817|             34|            124|            478|              145|            1044|               102|              454|   14|[2008, 2016, 2010...| 663|[79-HgXAN9dbSIz8Y...|   11|  Kim|   9775|    19|P5bUL3Engv-2z6kKo...|   2006-05-31|\n|uAinKQxXlMz1DvnZa...|    Nairn's Oatcakes|  4.0|                Food|           3|Edinburgh|55.9323726| -3.151056|3.9875117205937607|uAinKQxXlMz1DvnZa...|   1|2013-11-01|    2|yto19VIHuo_c8qHib...|     4|Im waiting for Na...|     1|P5bUL3Engv-2z6kKo...|         3.79|           1129|             47|            1129|           817|             34|            124|            478|              145|            1044|               102|              454|   14|[2008, 2016, 2010...| 663|[79-HgXAN9dbSIz8Y...|   11|  Kim|   9775|    19|P5bUL3Engv-2z6kKo...|   2006-05-31|\n|yejvTYPDqCtr3Mx7i...|Edinburgh Marriot...|  3.5|Venues & Event Sp...|           9|Edinburgh|55.9401012|-3.3114526| 6.377762289560828|yejvTYPDqCtr3Mx7i...|   1|2010-07-02|    2|iBxHzOnM94y50nRfC...|     3|As a Platinum lev...|     1|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n|K8D_ltZWGvdXUaSE7...| Southern Cross Cafe|  4.0|             British|          47|Edinburgh|55.9506245| -3.188629|1.3672752530481336|K8D_ltZWGvdXUaSE7...|   2|2010-07-03|    1|KdOjS5NFGQMnxXiRD...|     4|Limited choices f...|     2|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n|K8D_ltZWGvdXUaSE7...| Southern Cross Cafe|  4.0|        Coffee & Tea|          47|Edinburgh|55.9506245| -3.188629|1.3672752530481336|K8D_ltZWGvdXUaSE7...|   2|2010-07-03|    1|KdOjS5NFGQMnxXiRD...|     4|Limited choices f...|     2|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n|K8D_ltZWGvdXUaSE7...| Southern Cross Cafe|  4.0|                Food|          47|Edinburgh|55.9506245| -3.188629|1.3672752530481336|K8D_ltZWGvdXUaSE7...|   2|2010-07-03|    1|KdOjS5NFGQMnxXiRD...|     4|Limited choices f...|     2|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n|lCCF-E-83JJ5BCtYV...|    City Sightseeing|  4.0|     Hotels & Travel|          19|Edinburgh|55.9518489|-3.1918101|1.2331367936724573|lCCF-E-83JJ5BCtYV...|   3|2010-07-04|    2|nSbiWr1A8pcwhCHC1...|     2|Having ridden the...|     3|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n|K8D_ltZWGvdXUaSE7...| Southern Cross Cafe|  4.0|         Restaurants|          47|Edinburgh|55.9506245| -3.188629|1.3672752530481336|K8D_ltZWGvdXUaSE7...|   2|2010-07-03|    1|KdOjS5NFGQMnxXiRD...|     4|Limited choices f...|     2|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n|K8D_ltZWGvdXUaSE7...| Southern Cross Cafe|  4.0|               Cafes|          47|Edinburgh|55.9506245| -3.188629|1.3672752530481336|K8D_ltZWGvdXUaSE7...|   2|2010-07-03|    1|KdOjS5NFGQMnxXiRD...|     4|Limited choices f...|     2|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n|yejvTYPDqCtr3Mx7i...|Edinburgh Marriot...|  3.5|     Hotels & Travel|           9|Edinburgh|55.9401012|-3.3114526| 6.377762289560828|yejvTYPDqCtr3Mx7i...|   1|2010-07-02|    2|iBxHzOnM94y50nRfC...|     3|As a Platinum lev...|     1|hWDybu_KvYLSdEFzG...|         3.56|           1598|             13|            1598|          1150|             29|            338|            657|              730|            2063|               234|              862|16796|[2012, 2014, 2016...| 380|[WPCJbMPmJVZZQa_4...|16704|Bruce|   7818| 19776|hWDybu_KvYLSdEFzG...|   2009-03-08|\n+--------------------+--------------------+-----+--------------------+------------+---------+----------+----------+------------------+--------------------+----+----------+-----+--------------------+------+--------------------+------+--------------------+-------------+---------------+---------------+----------------+--------------+---------------+---------------+---------------+-----------------+----------------+------------------+-----------------+-----+--------------------+----+--------------------+-----+-----+-------+------+--------------------+-------------+\n\n\navg_stars: org.apache.spark.sql.DataFrame = [_c0: double, categories1: string]\n+---+--------------------+\n|_c0|         categories1|\n+---+--------------------+\n|4.0|            Bakeries|\n|4.0|                Food|\n|3.0|Venues & Event Sp...|\n|4.0|             British|\n|4.0|        Coffee & Tea|\n|2.5|     Hotels & Travel|\n|4.0|         Restaurants|\n|4.0|               Cafes|\n+---+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521919877212_1196003615","id":"20180324-153117_1231248854","dateCreated":"2018-03-24T15:31:17-0400","dateStarted":"2018-03-24T21:36:28-0400","dateFinished":"2018-03-24T21:39:08-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1367"},{"text":"//5. For the top 10 and bottom 10 category Food businesses in Q3, (in terms of stars), summarize star rating for reviews in January through May only.\n//top 10\nval new_data = dist_table.select(\"name\",\"categories1\",\"business_id\",\"stars\",\"distance_in_km\").where($\"categories1\"===\"Food\").where($\"distance_in_km\"<15)\n//new_data.show()\nval new_data1 = new_data.orderBy(desc(\"stars\")).limit(10)\n//new_data1.show()\n//bottom 10\nval new_data2 = new_data.orderBy(\"stars\").limit(10)\n//new_data2.show()\n\n//top 10 final\nval revattr = rev1.select(month($\"date\").alias(\"date_month\"),$\"business_id\",$\"stars1\")\nval top_10 = new_data1.join(revattr,\"business_id\").select(revattr(\"date_month\"),revattr(\"stars1\"),new_data1(\"name\"),new_data1(\"business_id\")).where(revattr(\"date_month\")<6)\ntop_10.groupBy(\"name\",\"business_id\").agg(avg(\"stars1\").alias(\"Rating\")).show()\n","user":"anonymous","dateUpdated":"2018-03-24T21:41:40-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nnew_data: org.apache.spark.sql.DataFrame = [name: string, categories1: string, business_id: string, stars: double, distance_in_km: double]\n\nnew_data1: org.apache.spark.sql.DataFrame = [name: string, categories1: string, business_id: string, stars: double, distance_in_km: double]\n\nnew_data2: org.apache.spark.sql.DataFrame = [name: string, categories1: string, business_id: string, stars: double, distance_in_km: double]\n\nrevattr: org.apache.spark.sql.DataFrame = [date_month: int, business_id: string, stars1: bigint]\n\ntop_10: org.apache.spark.sql.DataFrame = [date_month: int, stars1: bigint, name: string, business_id: string]\n+--------------------+--------------------+-----------------+\n|                name|         business_id|           Rating|\n+--------------------+--------------------+-----------------+\n|Enjoy Gusto Italiano|wB4uYGpc2SIqX_AQY...|              5.0|\n|Pinnies and Poppy...|IuFbk4fKxoXFqaxy9...|              5.0|\n|        I. J. Mellis|yXF__agAgymm2o0S2...|4.777777777777778|\n|         Leo & Ted's|i6tun6YkxmZ2XpJ5D...|              5.0|\n|          Soul Sushi|mX58qv1o62qWtP4Os...|              4.6|\n|     John Saunderson|JR35QvUeMG4w9BSG6...|             4.75|\n|        The Beerhive|zPd5geFzJRu01sM7P...|              5.0|\n|Ever So Sweet Cup...|3K5s-QQFiv1SIvOg8...|              5.0|\n|        La Barantine|yQjjVhYbNfWhjE2QM...|4.833333333333333|\n|First Class Butchers|cyv6UDFGz8X5eM-p9...|              5.0|\n+--------------------+--------------------+-----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521920345856_-1149195294","id":"20180324-153905_27241004","dateCreated":"2018-03-24T15:39:05-0400","dateStarted":"2018-03-24T21:40:55-0400","dateFinished":"2018-03-24T21:41:28-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1368"},{"text":"//Bottom 10 final\n\nval revattr = rev1.select(month($\"date\").alias(\"date_month\"),$\"business_id\",$\"stars1\")\nval top_10 = new_data2.join(revattr,\"business_id\").select(revattr(\"date_month\"),revattr(\"stars1\"),new_data2(\"name\"),new_data2(\"business_id\")).where(revattr(\"date_month\")<6)\ntop_10.groupBy(\"name\",\"business_id\").agg(avg(\"stars1\").alias(\"Rating\")).show()\n","user":"anonymous","dateUpdated":"2018-03-24T21:42:35-0400","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nrevattr: org.apache.spark.sql.DataFrame = [date_month: int, business_id: string, stars1: bigint]\n\ntop_10: org.apache.spark.sql.DataFrame = [date_month: int, stars1: bigint, name: string, business_id: string]\n+--------------------+--------------------+------------------+\n|                name|         business_id|            Rating|\n+--------------------+--------------------+------------------+\n|       Tesco Express|wBOJAjuDW0VeJRgd4...|               2.0|\n|Thaisanuk Restaurant|nQ_bo9d_CeO4gf19v...|               1.5|\n|        Fresh Choice|oov10EOaEWk2euPuO...|               1.0|\n|   Zucchero Cafe Bar|WxBZC1ry1tCZVmIO1...|               1.0|\n|The Broadsheet Bi...|HLgi9tJILVVsjmgDK...|2.3333333333333335|\n|          Owl & Deer|-J4jk3UT8MXAmzP7K...|               3.0|\n|           Margiotta|6RPX_sl-_eCJVcf8O...|               1.0|\n+--------------------+--------------------+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521927104855_-511830073","id":"20180324-173144_251328122","dateCreated":"2018-03-24T17:31:44-0400","dateStarted":"2018-03-24T21:41:45-0400","dateFinished":"2018-03-24T21:42:18-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1369"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521931079971_169724615","id":"20180324-183759_904238952","dateCreated":"2018-03-24T18:37:59-0400","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1370"}],"name":"assignment2_spark","id":"2DA1Y9H37","angularObjects":{"2CFXK5J4Y:shared_process":[],"2CF295UYG:shared_process":[],"2CD6ZRPDJ:shared_process":[],"2CFG6Y8G3:shared_process":[],"2CFJKQVBN:shared_process":[],"2CGYXR37V:shared_process":[],"2CDY97F39:shared_process":[],"2CEC5KMFB:shared_process":[],"2CFFWS5P3:shared_process":[],"2CDM4T1EH:shared_process":[],"2CG949ZHZ:shared_process":[],"2CEJ86HV3:shared_process":[],"2CFGNABPQ:shared_process":[],"2CEZV3CHG:shared_process":[],"2CDUTWP3P:shared_process":[],"2CFXDXWCE:shared_process":[],"2CEZMWG72:shared_process":[],"2CFWFHNZR:shared_process":[],"2CG23YGEZ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}